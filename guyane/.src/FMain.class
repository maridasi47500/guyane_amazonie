' Gambas class file

 


Public Sub ok_Click()

End 



Public Sub MyButton() 
  
  '''Message.info("hi!!!")
  
End


Public Sub Form_Open()

  MODMain.Main()
  Dim test As CheckBox
Dim tmp As String


  
Dim myargs As Collection

Dim $incr As Integer


  Dim mp As New MapPoint(3.785, -52.861)   ' Punto 2)
 ' oppure: mp.Lat = 41.89018
 '         mp.Lon = 12.49230



  MapView1.Map.DefaultCache = "/home/mary/gambas"
  MapView1.Map.AddTile("openstreet", "http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", Null, "cartes")  ' Punti 4) e 5)
  MapView1.Map.Zoom = 7          ' Punto 6)
  MapView1.Map.Center = mp        ' Punto 7)
  
  
  Dim $table1 As String, $table2 As String, $query22 As String, $query2 As String, $Result2 As Result, $Results2 As Result, $incr6 As Integer
  Dim $myparent As Integer
  Dim $check As RadioButton, $var As String
  Dim $yradiobtn As Integer
 $Query22 = "select * from mypages"
  $table2 = "mypages"
  ''
  $query2 = "" 
 $Result2 = MODMain.$Con.Exec($Query22)
                $Results2 = MODMain.$Con.Find($table2, $query2)
                $incr = 0
                $myparent = 100
                $yradiobtn = 20
                $incr = 0
                ' For Each $var In $Results2.All("title")
                '   TextArea1.text = TextArea1.text & " - " & $var & " - " & $Results2.All("id")[$incr]
                '   $incr = $incr + 1
                ' Next
             ' For Each $var In $Results2.All("title")
             '   
             '   $check = New Radiobutton(mespages)
             '   $check.name = "monmenu" & $incr
             ' 
             '   $check.Text = $var
             '   TextArea1.text = TextArea1.text & " - " & $var
             '   $check.Value = $results2.All("id")[$incr]
             '   $check.Reparent(mespages)
             '   $check.X = $myparent
             '   $check.width = 230
             '   
             '   $check.Y = $yradiobtn
             '   $myparent = $myparent + 240
             '   $incr = $incr + 1
             '   If $myparent > (mespages.width - 250) Then
             '     $myparent = 100
             '     $yradiobtn = $yradiobtn + 30
             '     mespages.height = mespages.height + 30
             '   Endif
             '   ''ajouter evenement
             '   tmp = "MyButton"
             '   Object.Attach($check, mespages, tmp)
             ' Next
             ' 
Dim m As RadioButton
m = mespages.Children[0]
If m Then
  

m.Value = True  ' RadioButton2 is selected
m.SetFocus
Endif

  ''MapView1.Map.DefaultCache = "/percorso/non/temporaneo/della/cartella/delle/tessere"

''MapView1.Map.AddTile("Esempio", Null, Null, "nome_cartella")


End

Public Sub nomChamp_KeyPress()

Print Key.code 

End

Public Sub communeChamp_MouseDown()

  

End

Public Sub autrerecherche_MouseDown()

  ' '''Message.info("test")

End

Public Sub chercherBtn_Click()


End

Public Sub imageresult_MouseDown()



End

Public Sub Timer1_Timer()

  

End

Public Sub MapView1_MouseDown()

lat.text = MapView1.Map.Center.Lat
lon.text = MapView1.Map.Center.Lon

End

Public Sub MapView1_Draw()
  MAPMain.initmap()
End

Public Sub FileProperties1_MouseDown()

  

End

Public Sub TabStrip1_Click()

  

End

Public Sub TabStrip2_Click()



End

Public Sub monmenu_Click()
Dim $table As String
Dim $query As String
Dim $Query1 As String
Dim $Result As Result
Dim $Results As ContainerChildren
Dim $Results1 As Result
Dim $Results2 As Result
Dim $Results3 As Result
Dim $Results4 As Result
Dim $Results5 As Result
Dim $msg As String
Dim $type As String
Dim $table2 As String
Dim $query2 As String
Dim $query22 As String
Dim $Result2 As Result
Dim $msg2 As String
Dim $type2 As String

Dim $var As String
Dim $check As CheckBox
Dim $value As String
Dim $incr As Integer
Dim $incr2 As Integer
Dim $myparent As Integer
Dim $res As String
Dim $res2 As String
Dim $mytext As Label
Dim $res3 As String
Dim $res4 As String
Dim $res5 As Integer
Dim $incr1 As Integer
Dim $resultsqls As Result
Dim $myincr As Integer

Dim $myradiobtn As RadioButton

autrerecherche.Children.clear
autrerecherche.Children.Clear



                $Results = mespages.Children
                $myincr = 1
                For Each $myradiobtn In $Results
                  
                    
                      If $myradiobtn.Value == True And $myradiobtn.HasFocus Then
                         $incr = 0
                          $myparent = 40
                          $res = $myincr
                        $Results5 = MODMain.$Con.Find("optiontypes", "where mypage_id = '" & $res & "'") 
                        For Each $res3 In $Results5.All("id")
                            $mytext = New Label(autrerecherche)
               $mytext.Text = $Results5.All("title")[$incr]

               $mytext.Reparent(autrerecherche)
               
               $mytext.Y = $myparent
               $mytext.width = 250
               $mytext.height = 50
               $mytext.X = 20
               $myparent = $myparent + 40
               autrerecherche.height = autrerecherche.height + 40
                          $Results4 = MODMain.$Con.Find("options", "where optiontype_id = '" & $res3 & "'") 
                          
                          $incr2 = 0
                          For Each $res5 In $Results4.All("id")
   $check = New CheckBox(autrerecherche)
               $check.Text = $Results4.All("title")[$incr2]
               $check.Value = 0
               $check.tag = $res5
               
               $check.Reparent(autrerecherche)
               
               $check.Y = $myparent
               $check.width = 250
               
               $check.X = 20
               $myparent = $myparent + 20
               
               $incr2 = $incr2 + 1
                          
                        Next
                        $incr = $incr + 1
                        Next
                        Continue
                      Endif
                    
                  $myincr = $myincr + 1
                  
                Next
' $Query1 = "select * from activites"
'   $table = "activites"
'   $query = "where type = '" & $type & "'"
'                 $Result = MODMain.$Con.Exec($Query1)
'                 $Resultsqls = MODMain.$Con.Find($table, $query)
'                 If $Result And $Result.Available Then
'               $Query22 = "select * from options"
'   $table2 = "options"
'   ''
'   $query2 = "" '' "where ac.type = '" & $type & "'" '' left join type_" & $type & "s a on a.option_id = options.id left join activites ac on ac.id = a.activite_id"
'                 $Result2 = MODMain.$Con.Exec($Query22)
'                 $Results2 = MODMain.$Con.Find($table2, $query2)
'                 $incr = 0
'                 $myparent = 40
'              For Each $var In $Results2.All("title")
'                
'                $check = New CheckBox(autrerecherche)
'                $check.Text = $var
'                $check.Value = $results2.All("id")[$incr]
'                $check.Reparent(autrerecherche)
'                $check.Y = $myparent
'                $check.width = 100
'                
'                $check.X = 20
'                $myparent = $myparent + 40
'                $incr = $incr + 1
'                
'              Next
             
                ' Else 
                '   '''Message.info("Aucun résultat ne correspond à votre recherche")
                ' End If

End



Public Sub rechercherBtn_Click()
Dim $table As String
Dim $query As String
Dim $Query1 As String
Dim $Result As Result
Dim $Results As ContainerChildren
Dim $Results1 As Result
Dim $Results2 As Result
Dim $Results3 As Result
Dim $Results4 As Result
Dim $Results5 As Result
Dim $msg As String
Dim $type As String
Dim $table2 As String
Dim $query2 As String
Dim $query22 As String
Dim $Result2 As Result
Dim $msg2 As String
Dim $type2 As String

Dim $var As String
Dim $check As CheckBox
Dim $value As String
Dim $incr As Integer
Dim $incr2 As Integer
Dim $myparent As Integer
Dim $res As String
Dim $res2 As String
Dim $mytext As Label
Dim $res3 As String
Dim $res4 As String
Dim $res5 As Integer
Dim $incr1 As Integer
Dim $resultsqls As Result
Dim $myincr As Integer
Dim $myincre As Integer
Dim $myradiobtn As RadioButton
Dim $currentcb As Checkbox
Dim $mesresultats As Result
Dim $mesresultatssql As String
Dim $mesactivites As Result
Dim $mesactivitessql As String
Dim $nbcb As Integer
 Dim $img As Image
 Dim $nameimg As String
$nbcb = 0
 Dim firstone As Boolean
                          firstone = False
$mesresultatssql = "where option_id in ("

                $Results = mespages.Children
                '''If autrerecherche.Children.count > 0
                $myincr = 1
                $myincre = 0
                  '''Message.info($Results.Count & "boutons de radio")
                For Each $myradiobtn In $Results
                    Dim $k As String
                    If $myradiobtn.HasFocus 
                    $k = "true" 
                    Else
                    $k = "False"
                    End If
                      '''Message.info($k, "ok pour " & $myradiobtn.name)
                      
                      If $myradiobtn.value = True Then
                         $incr = 0
                          $myparent = 40
                          $res = $myincr
                        $Results5 = MODMain.$Con.Find("optiontypes", "where mypage_id = '" & $res & "'") 
                        
                        '''Message.info($Results5.count & " types d'option")
                        For Each $res3 In $Results5.All("id")
                            
                          $Results4 = MODMain.$Con.Find("options", "where optiontype_id = '" & $res3 & "'") 
                          
                          $myincre = $myincre + 1
                          '''Message.info($Results4.Length & " resultats")
                         If autrerecherche.Children.count > 0
                          For Each $res5 In $Results4.All("id")
                                  
                                  
                                  $currentcb = autrerecherche.Children[$myincre]
                                  '''Message.info($currentcb.name)
                                  Dim myint As Integer
                                  
                                 
                                  If $currentcb.value = True Then
                                    If firstone Then
                                      $mesresultatssql = $mesresultatssql & ","
                                  Else 
                                    firstone = True
                                    Endif
                                    $mesresultatssql = $mesresultatssql & $res5 
                                    $nbcb = $nbcb + 1
                                  Endif
                                    $myincre = $myincre + 1
                          
                          Next
                          Endif
                        $incr = $incr + 1
                        Next
                        Continue
                      Endif
                    
                  $myincr = $myincr + 1
                  
                Next
  
$mesresultatssql = $mesresultatssql & ")"


' rajouter et que les activites dont les titres ou les communes ressemblent à la requete de l'user
'''
'''Message.Info(communeChamp.text[0, communeChamp.Text.len])
Dim $macommune As String
Dim $monnom As String
Dim $nomstr As String
Dim $comstr As String
Dim $usetxt As Boolean
Dim $usetxtstr As String
Dim $tablejointure As String
Dim $resultatdemesactivites As Result
Dim $resultatdemesactivitessql As String
$macommune = communeChamp.Text
$monnom = nomChamp.text
Print "mon nom", $monnom
Print "ma commune", $macommune
If $macommune.len > 0 Or $monnom.len > 0
$mesactivitessql = "where"
$usetxtstr = "and"
If $macommune And $macommune.len > 0
$comstr = " commune like '%" & $macommune & "%'"
$mesactivitessql = $mesactivitessql & $comstr
$usetxtstr = $usetxtstr & $comstr
Endif 
If $monnom And $monnom.len > 0 Then
  If $comstr Then
    $mesactivitessql = $mesactivitessql & " and"
    $usetxtstr = $usetxtstr & " and"
  Endif
  $mesactivitessql = $mesactivitessql & " nom Like '%" & $monnom & "%'"
  $usetxtstr = $usetxtstr & " nom Like '%" & $monnom & "%'"
Endif 
$usetxt = True

 Else 
    $mesactivitessql = ""
    Print "l'utilisateur n'a employé aucun champ"
    $usetxt = False
Endif
Print "sql"
Print $mesactivitessql
'''Message.info($mesresultatssql)
'''seulement si plus d'une ceck box est selectionnee
Dim $myvar As Integer
$myvar = 0
Print "nbcb"
Print $nbcb

If $nbcb And CInt($nbcb) > 0 Then
  $myvar = 1

$mesresultats = MODMain.$Con.Find("mytypes", $mesresultatssql)
$resultatdemesactivites = MODMain.$Con.Find("mytypes", $mesresultatssql)
$resultatdemesactivitessql = $mesresultatssql
'' la chine contient toutes les activites des types selection
Endif


 '''$mesactivites = MODMain.$Con.Find("activites", $mesactivitessql)
 If $mesactivitessql = "" Then
    $mesactivites = $mesactivites
 Else
 $mesactivites = MODMain.$Con.Exec("select * from activites " & $mesactivitessql)
 Endif
 ''''''''''''''''''''''''''''''la variable activites contient uniquement celle cherchees avec nom et commune ou toutes les activites
 ''''''''''''''''''
 Print "(table 'mytypes') résultats cherchés dans les colonnes : option_id (cases à cocher)"
Print CStr($mesresultatssql)
Print "Nombre de résultats : " 
If $mesresultats Then
Print CStr($mesresultats.count)
Else 
Print "0"
Endif 
 Print "(table 'activites') résultats cherchés dans les colonnes : nom et commune (champ de texte)"
Print CStr($mesactivitessql)
Print "Nombre de résultats : "
If $mesactivites Then
Print CStr($mesactivites.count)
Else 
Print "0"
Endif 



'''comment rechercher mes activites dans la table jointure

If IsNull($mesactivites) Then
  
 Print "aucun résultat trouvé avec les champs (champs vides)"
  Else 
  

If $mesactivites.count > 0 Then
  Print "il y a plus d'une d'activités"
  firstone = False
  Print "comment il faudra rechercher mes activites dans la table jointure ?"
  $tablejointure = "activite_id in("
  For Each $res5 In $mesactivites.All("id")
    If firstone Then

      $tablejointure = $tablejointure & ","
      Else 
        firstone = True
  Endif  
  $tablejointure = $tablejointure & $res5 

  Next
  $tablejointure = $tablejointure & ")"
  Print $tablejointure
  Else 
    Print "0 activités trouvées"
    $tablejointure = ""
    Endif
   


Endif

  


''' ecrire la suite de la chaine  select * from mytypes (option_id et activite_id)
'chercher aussi dans la colonne option_id de mytypes
Print "comment rechercher les options dans la table jointure"
Dim $othersql As String
Dim $jointothersql As String

$jointothersql = ""
$jointothersql = $resultatdemesactivitessql
'If Not IsNull($resultatdemesactivites) Then
'If $resultatdemesactivites.count > 0 Then
'  Print "l'utilisateur a cherche plus d'un type d'activite"




'$jointothersql = $jointothersql & "activite_id in ("
'firstone = False
'For Each $res5 In $resultatdemesactivites.All("id")
 '   If firstone Then

 '     $jointothersql = $jointothersql & ","

 '     Else 
'        firstone = True
'  Endif  
 
'  $jointothersql = $jointothersql & $res5

'Next

'$jointothersql = $jointothersql & ")"
'Endif
'''''''''''''''''''''''''''''''''''''''''''''''''''
If $jointothersql = "" Then
  Print "l'utilisateuru a sélectionné 0 options"
Endif


''resultat de la jointure

Dim $monresultatjointure As Result
Dim $marequete As String

$marequete = "select * from mytypes "
If Not $tablejointure = "" Then
  $marequete = $marequete & " where " & $tablejointure
Endif
If Not $jointothersql = "" Then 
  If $tablejointure = "" Then 
    $marequete = $marequete & " where "
   Else 
     $marequete = $marequete & " and  "
  Endif
  $marequete = $marequete & $jointothersql[6, ($jointothersql.len - 1)]
Endif


Print $marequete
If Not $jointothersql = "" Or Not $tablejointure = ""
$monresultatjointure = MODMain.$Con.Exec($marequete)
End If
''''''''''''''''''''''''''''''''''''''''
'''Dim $monresultatactivites As Result  ''$mesactivites
Dim $marequeteactivite As String
If IsNull($monresultatjointure) Then
  
Print "il n'y a aucun resultat dans la jointure"
''Message.Info("il n'y a aucun résultat dans la jointure")
resultats.visible = False
Else
If $monresultatjointure.count > 0 Then
  
Print "il y a " & $monresultatjointure.count & " résultats dans la jointure"
$marequeteactivite = "where id in ("
firstone = False
For Each $res5 In $monresultatjointure.All("activite_id")
    If firstone Then

      $marequeteactivite = $marequeteactivite & ","

      Else 
        firstone = True
  Endif  
 
  $marequeteactivite = $marequeteactivite & $res5

Next
  Print "résultat dans la jointure :"
$marequeteactivite = $marequeteactivite & ")"
Print $marequeteactivite


''' opur donner moins de résultats si rechercher par la categorie donne plus de resultats que chercher aussi par le nom ou commune
'If $usetxt Then
' $marequeteactivite = $marequeteactivite & $usetxtstr
'Endif
'''''''''''''''''''''''


$mesactivites = MODMain.$Con.Exec("select * from activites " & $marequeteactivite)
Print "il y a " & $monresultatjointure.count & " résultats dans la jointure"

Else 
  Print "il n'y a aucun résultat dans la jointure"
  ''Message.Info("il n'y a aucun résultat dans la jointure")
resultats.visible = False
Endif 
End If
'''''''''''''''''''''''''''''''''''''''''
'Else 
'Print "l'utilisateur n'a cherche aucun type d'activite"
'Print "les activites sont celles cherchees precedemment avec les champ nom et commune"
'  Endif
''''''''''''

''''''''''''''''''''''







''''''''''''''''''''''''''''''''

  
  
  If IsNull($mesactivites) Then 
    Message.info("Aucune activité ne correspond à votre recherche")
  resultats.visible = False
 Else If $mesactivites.count = 1 Then
     resultats.text = "Résultats (1 résultat)"
   resultats.visible = True
   listresults.index = 0
   
   
    $nameimg = $mesactivites["photo"]
    Print "image: "
    Print $nameimg
    If $nameimg.len > 0
    $img = Image.load($nameimg)
    
   imageresult.image = $img
   Endif
   resulttext.text = $mesactivites["nom"] & " " & $mesactivites["commune"] & " " & $mesactivites["infos"]
   mycursor.text = "0"
   suivant.visible = False
   imageresult.visible = True
   precedent.visible = False
   
   Print $mesactivites
   Print CStr($mesactivites[2]), CStr($mesactivites[1])
   Else If $mesactivites.count > 1
     Dim $myint As Integer
     Dim myid As Integer
     Print $mesactivites
  $myint = 0
  resultats.text = "Résultats (" & CStr($mesactivites.All("id").Count) & " résultats)"
  listresults.Clear
   For Each myid In $mesactivites.All("id")
     listresults.Add(CStr(myid))
     
     $myint = $myint + 1
   Next
   listresults.index = 0
   
    
    $nameimg = $mesactivites["photo"]
    Print $nameimg
    If $nameimg.len > 0
    $img = Image.load($nameimg)
    
   imageresult.image = $img
   Endif
   resulttext.text = $mesactivites["nom"] & " " & $mesactivites["commune"] & " " & $mesactivites["infos"]
   resultats.visible = True
   mycursor.text = "0"
   suivant.visible = True
   imageresult.visible = True
   precedent.visible = True
   
     Else
     Message.Info("Aucune activité ne correspond à votre recherche")
     resultats.visible = False
 Endif

  
'''Else 
  '''Message.Info("sélectionnez une(des) catégorie(s) d'activité")
  '''Endif 
  '''Else 
  '''Message.info("sélectionnez une catégorie d'activité")
'''End If


''enregistrer des resultats du site

'marquer les resultats sur la carte
'''

End

Public Sub CheckBox1_Click()

  

End


Public Sub monmenu_GotFocus()

  

End

Public Sub communeChamp_KeyPress()

  

End

Public Sub createBtn_Click()

  FCreate.Show

End

Public Sub suivant_Click()
Print "current"
Print listresults.Current.Text
Dim $mesactivites As Result
  If listresults.index = (listresults.list.count - 1) Then
     listresults.index = 0
     Else 
       listresults.index = listresults.index + 1
   Endif



 $mesactivites = MODMain.$Con.Exec("select * from activites where id = '" & listresults.text & "'")
     Dim img As Image
    Dim nameimg As String
    nameimg = $mesactivites["photo"]
    Print nameimg
    If nameimg.len > 0
    img = Image.load(nameimg)
    
   imageresult.image = img
   Else 
     img = Null
     imageresult.image = Null
   Endif
   resulttext.text = $mesactivites["nom"] & " " & $mesactivites["commune"] & " " & $mesactivites["infos"]

End

Public Sub precedent_Click()
Dim $mesactivites As Result
Print listresults.selected
Print "index list results"
Print listresults.index

Print listresults.list.count
    If listresults.index = 0 Then
      
      Print listresults.list
     listresults.index = (listresults.list.count - 1)
     
     Else 
       listresults.index = listresults.index - 1
   Endif
 
 $mesactivites = MODMain.$Con.Exec("select * from activites where id = '" & listresults.text & "'")
     Dim img As Image
    Dim nameimg As String
    nameimg = $mesactivites["photo"]
    Print nameimg
    If nameimg.len > 0
    img = Image.load(nameimg)
    
   imageresult.image = img
   Else 
     img = Null
     imageresult.image = Null
   Endif
   resulttext.text = $mesactivites["nom"] & " " & $mesactivites["commune"] & " " & $mesactivites["infos"]

End
